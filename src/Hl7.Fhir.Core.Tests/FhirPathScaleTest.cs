using Hl7.Fhir.FhirPath;
using Hl7.Fhir.Model;
using Hl7.Fhir.Serialization;
using Hl7.Fhir.Utility;
using Hl7.Fhir.Tests;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using Hl7.FhirPath;
using Hl7.Fhir.Model.Primitives;
using Hl7.FhirPath.Expressions;
using Hl7.Fhir.ElementModel;

namespace Hl7.Fhir
{
    [TestClass]
    public class FhirPathPerformanceTests
    {
        [TestMethod]
        public void QuestionnaireResponseFhirpathPocoTest()
        {
            var xml = TestDataHelper.ReadTestData("Large-QuestionnaireResponse.xml");

            var qr = (new FhirXmlParser()).Parse<QuestionnaireResponse>(xml);

            var trace = Hl7.FhirPath.FhirPathCompiler.DefaultSymbolTable.Filter("trace", 2);
            SymbolTableExtensions.Add(Hl7.FhirPath.FhirPathCompiler.DefaultSymbolTable, "dateadd",
                (PartialDateTime f, string field, long amount) =>
                {
                    DateTimeOffset dto = f.ToUniversalTime();
                    int value = (int)amount;

                    // Need to convert the amount and field to compensate for partials
                    //TimeSpan ts = new TimeSpan();

                    switch (field)
                    {
                        case "yy": dto = dto.AddYears(value); break;
                        case "mm": dto = dto.AddMonths(value); break;
                        case "dd": dto = dto.AddDays(value); break;
                        case "hh": dto = dto.AddHours(value); break;
                        case "mi": dto = dto.AddMinutes(value); break;
                        case "ss": dto = dto.AddSeconds(value); break;
                    }
                    PartialDateTime changedDate = PartialDateTime.Parse(PartialDateTime.FromDateTime(dto).ToString().Substring(0, f.ToString().Length));
                    return changedDate;
                });

            var v4 = qr.ToElementNavigator();
            var v5 = v4.Select("group.group.where(linkId = 'Section-A').question.where(linkId = 'WorkerGivenNames').answer.value").FirstOrDefault() as PocoNavigator;
            Assert.AreEqual("QuestionnaireResponse.group.group.where(linkId='Section-A').question.where(linkId='WorkerGivenNames').answer[0].value", v5.CommonPath);
            Assert.AreEqual("QuestionnaireResponse.group.group[0].question[5].answer[0].value", v5.ShortPath);
            Assert.AreEqual("QuestionnaireResponse.group[0].group[0].question[5].answer[0].value[0]", v5.Location);

            // Now perform some FHIRpath operations on it
            string bigValidationExpression = "(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.toString().length() <= 8).trace('A001a') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.toString().length() <= 2).trace('A001b') and((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty().not())).trace('A001c') and((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty()                              and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty()                              and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() = 0)                              or((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty().not()                              or QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty().not())                             xor QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() > 0                           )).trace('A001d') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() <= 40).trace('A001e') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'WorkerDateOfBirth').answer.where(value < @2017-04-10).exists()).trace('A001f') and(QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value).trace('B001') and(group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.where(value <= @2017-04-10).exists()).trace('B001') and(QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'WorkerDateOfBirth').answer.value).trace('B003') and(group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.where(value <= @2017-04-10).exists()).trace('B002') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value).trace('C008') and((QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value) and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value) and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value)).trace('C009') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value.toString().length() = 0).trace('C001') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value).trace('C002') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value).trace('C003') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value.toString().length() = 10).trace('DateReturnToNormalDutiesMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 10).trace('SuitableDutiesFromMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.toString().length() = 10).trace('SuitableDutiesToMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value <= QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 0  or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.toString().length() = 0)).trace('GN006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 0)).trace('C004') and(group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 10).trace('UnfitSuitableDutiesFromMandatory') and(group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value.toString().length() = 10).trace('UnfitSuitableDutiesToMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 0).trace('C005') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value <= QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 0 or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value.toString().length() = 0)).trace('GN006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.value).trace('C010') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.value.not()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.count() + QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.count() + QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.where(valueBoolean = true).count() < 2)).trace('C010') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.toString().length() <= 2).trace('CapacityRTWDaysMaxLength') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.toString().length() <= 2).trace('CapacityRTWWeeksMaxLength') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.toInteger().all($this >= 0 and $this <= 31)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.toInteger().all($this >= 0 and $this <= 52)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'ReviewDate').answer.value > @2017-04-10).trace('C006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'ReviewDate').answer.value <= @2017-04-10.dateadd('yy', 1)).trace('C007') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.group.where(linkId = 'D2fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.group.where(linkId = 'D4fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.group.where(linkId = 'D6fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.group.where(linkId = 'D8fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.group.where(linkId = 'E17fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.value = false) )).trace('E005') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.group.where(linkId = 'E15fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.value = false) )).trace('E003') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseOverWeeks').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty().not()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = false) )).trace('E001') and((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() >= 0.0 and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() <= 24.0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty())).trace('E004') and((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal() >= 0.0 and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal() <= 24.0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.empty())).trace('E004') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseOverWeeks').answer.value.toInteger().all($this >= 1 and $this <= 52)).trace('E001') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() <= QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = false) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.empty()))).trace('E006') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.value = true and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveDays').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveWeeks').answer.value.empty().not())) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.value = false) )).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveDays').answer.value.toInteger().all($this >= 1 and $this <= 31)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveWeeks').answer.value.toInteger().all($this >= 1 and $this <= 52)).trace('GN008') and((QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'CaseManagerToContact').answer.value = false and QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'EmployerToContact').answer.value = false) or((QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'CaseManagerToContact').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'EmployerToContact').answer.value = true) and(QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactPhone').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactEmail').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactFax').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactWriting').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactVisit').answer.value = true))).trace('F001') and(group.group.where(linkId = 'Section-G').question.where(linkId = 'CompletionDate').answer.value <= @2017-04-10).trace('G001') and(group.group.where(linkId = 'Section-G').question.where(linkId = 'ProviderMedicareNo').answer.value.matches('^[0-9]{6}[A-Za-z]{2}$|^[0-9]{7}[A-Za-z]{1}$')).trace('G002')";
            string mediumValidationExpression = "(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.toString().length() <= 8).trace('A001a') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.toString().length() <= 2).trace('A001b') and((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty().not())).trace('A001c') and((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty()                              and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty()                              and QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() = 0)                              or((QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberPrefix').answer.value.empty().not()                              or QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimNumberSuffix').answer.value.empty().not())                             xor QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() > 0                           )).trace('A001d') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'ClaimReference').answer.value.toString().length() <= 40).trace('A001e') and(group.group.where(linkId = 'Section-A').question.where(linkId = 'WorkerDateOfBirth').answer.where(value < @2017-04-10).exists()).trace('A001f')"; // and(QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value).trace('B001') and(group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.where(value <= @2017-04-10).exists()).trace('B001') and(QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-A').question.where(linkId = 'WorkerDateOfBirth').answer.value).trace('B003') and(group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.where(value <= @2017-04-10).exists()).trace('B002') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value).trace('C008') and((QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value) and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value) and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value < QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value)).trace('C009') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value.toString().length() = 0).trace('C001') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value).trace('C002') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value > QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value).trace('C003') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C1').answer.group.where(linkId = 'C1fields').question.where(linkId = 'DateReturnToNormalDuties').answer.value.toString().length() = 10).trace('DateReturnToNormalDutiesMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 10).trace('SuitableDutiesFromMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.toString().length() = 10).trace('SuitableDutiesToMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value <= QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 0  or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesTo').answer.value.toString().length() = 0)).trace('GN006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'ExaminationDate').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C4').answer.group.where(linkId = 'C4fields').question.where(linkId = 'SuitableDutiesFrom').answer.value.toString().length() = 0)).trace('C004') and(group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 10).trace('UnfitSuitableDutiesFromMandatory') and(group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value.toString().length() = 10).trace('UnfitSuitableDutiesToMandatory') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value >= QuestionnaireResponse.group.group.where(linkId = 'Section-B').question.where(linkId = 'DateOfInjury').answer.value or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 0).trace('C005') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value <= QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesFrom').answer.value.toString().length() = 0 or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'UnfitSuitableDutiesTo').answer.value.toString().length() = 0)).trace('GN006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.value).trace('C010') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.value.not() or QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.value.not() or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.empty() and QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.value.not()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.count() + QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.count() + QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWUncertain').answer.where(valueBoolean = true).count() < 2)).trace('C010') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.toString().length() <= 2).trace('CapacityRTWDaysMaxLength') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.toString().length() <= 2).trace('CapacityRTWWeeksMaxLength') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWDays').answer.value.toInteger().all($this >= 0 and $this <= 31)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'C7').answer.group.where(linkId = 'C7fields').question.where(linkId = 'C11').answer.group.where(linkId = 'C11fields').question.where(linkId = 'CapacityRTWWeeks').answer.value.toInteger().all($this >= 0 and $this <= 52)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'ReviewDate').answer.value > @2017-04-10).trace('C006') and(QuestionnaireResponse.group.group.where(linkId = 'Section-C').question.where(linkId = 'ReviewDate').answer.value <= @2017-04-10.dateadd('yy', 1)).trace('C007') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.group.where(linkId = 'D2fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D2').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.group.where(linkId = 'D4fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D4').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.group.where(linkId = 'D6fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D6').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.group.where(linkId = 'D8fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-D').group.where(linkId = '1557925D-117A-4066-80B6-4688AC1BB285').question.where(linkId = 'D8').answer.value = false) )).trace('GN009') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.group.where(linkId = 'E17fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E17').answer.value = false) )).trace('E005') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.group.where(linkId = 'E15fields').question.answer.value.toString().length() > 0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').question.where(linkId = 'E15').answer.value = false) )).trace('E003') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseOverWeeks').answer.value.empty().not() and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty().not()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = false) )).trace('E001') and((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() >= 0.0 and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() <= 24.0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty())).trace('E004') and((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal() >= 0.0 and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal() <= 24.0) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.empty())).trace('E004') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseOverWeeks').answer.value.toInteger().all($this >= 1 and $this <= 52)).trace('E001') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = true and QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.toDecimal() <= QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.toDecimal()) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.value = false) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursFrom').answer.value.empty() or QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E19').answer.group.where(linkId = 'E19fields').question.where(linkId = 'GraduatedIncreaseHoursTo').answer.value.empty()))).trace('E006') and(((QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.value = true and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveDays').answer.value.empty().not() or QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveWeeks').answer.value.empty().not())) or(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.value = false) )).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveDays').answer.value.toInteger().all($this >= 1 and $this <= 31)).trace('GN007') and(QuestionnaireResponse.group.group.where(linkId = 'Section-E').group.where(linkId = '9488b6e9-619a-470d-b6d6-e30ca1c2b99e').question.where(linkId = 'E23').answer.group.where(linkId = 'E23fields').question.where(linkId = 'NonConsecutiveWeeks').answer.value.toInteger().all($this >= 1 and $this <= 52)).trace('GN008') and((QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'CaseManagerToContact').answer.value = false and QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'EmployerToContact').answer.value = false) or((QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'CaseManagerToContact').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').question.where(linkId = 'EmployerToContact').answer.value = true) and(QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactPhone').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactEmail').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactFax').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactWriting').answer.value = true or QuestionnaireResponse.group.group.where(linkId = 'Section-F').group.where(linkId = '0B432B1B-18E6-4659-B0ED-713E54F5EFA5').question.where(linkId = 'PreferredContactVisit').answer.value = true))).trace('F001') and(group.group.where(linkId = 'Section-G').question.where(linkId = 'CompletionDate').answer.value <= @2017-04-10).trace('G001') and(group.group.where(linkId = 'Section-G').question.where(linkId = 'ProviderMedicareNo').answer.value.matches('^[0-9]{6}[A-Za-z]{2}$|^[0-9]{7}[A-Za-z]{1}$')).trace('G002')";
            // FhirPathCompiler compiler = new FhirPathCompiler();
            //var exp = compiler.Compile(bigValidationExpression);
            for (int n = 0; n < 100; n++)
            {
                bool result = qr.Predicate(mediumValidationExpression);
                Assert.IsTrue(result, "This weird validation should have passed");
            }

            bool resultBig = qr.Predicate(bigValidationExpression);
            Assert.IsTrue(resultBig, "This weird big validation should have passed");
        }
    }

}
